import{r as l,d as y,w,a as S,I,g as p,i as u,j as F,k as H,l as e,v as i,q as x,m as k,u as b,F as $,t as j,y as D,C as M,A as U,n as W,J as z,x as m,H as J}from"./index-yT-nRwf0.js";import{u as G,L as K,a as O}from"./LoadingEffect-C_Egt85T.js";import{u as Q}from"./tools-DaVbfOsv.js";import{P as X}from"./vuejs-paginate-next.es-MiVyFMoV.js";import{H as Y,F as Z}from"./FooterView-CTXdy-ba.js";const ee={class:"wrapper"},ae={class:"container"},se={class:"d-flex justify-content-between align-items-center flex-sm-row flex-column"},te={class:"fs-lg-2 fs-3 my-lg-8 my-sm-6 my-4"},oe={class:"text-warning"},le={class:"row g-4 mb-lg-8 mb-6 row-cols-xl-6 row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-1"},ne={class:"card card-search text-bg-dark h-100"},re=["src","alt"],ce={class:"fs-lg-5 fs-6"},ue={class:"fs-lg-5 fs-6"},ie={class:"card-text"},de='<i class="bi bi-caret-left-fill"></i>',me='<i class="bi bi-caret-right-fill"></i>',_e={__name:"SearchAlbum",setup(ge){const q=G(),{getConfigAuthToken:P}=q,h=l({}),n=l({isLoading:!1,fullPage:!0,bgColor:"rgba(0,0,0,0.9)"}),C=y(()=>({active:n.value.isLoading,fullPage:n.value.fullPage,...n.value.bgColor&&{backgroundColor:n.value.bgColor}})),L=()=>{n.value.isLoading=!0},V=()=>{n.value.isLoading=!1},g=l({albums:{data:[]}}),r=U(),T=J(),_=l(0),c=l(Number(r.query.page)||1),f=l(12),R=y(()=>Math.ceil(_.value/f.value)),A=t=>{c.value=t,T.push({query:{...r.query,page:t}}),W(()=>{const a=document.activeElement;a&&a.tagName==="A"&&a.blur()})};w(c,()=>{v(o.value),N()}),w(()=>r.query.page,t=>{c.value=Number(t)||1});const B=Q(),{processDash:E}=B,N=()=>{window.scrollTo({top:0,behavior:"smooth"})},o=l(""),v=t=>{L();const a=(c.value-1)*f.value,d=f.value;O.get(`https://api.kkbox.com/v1.1/search?q=${t}&territory=TW&type=artist,track,album,playlist&limit=${d}&offset=${a} `,h.value).then(s=>{g.value.albums.data=s.data.albums.data,_.value=s.data.albums.summary.total,V()})};return S(async()=>{h.value=await P(),r.query.q&&(o.value=r.query.q,v(o.value))}),I(t=>{t.query.q&&(o.value=t.query.q,v(o.value))}),(t,a)=>{const d=z("RouterLink");return m(),p("div",ee,[u(K,F(H(C.value)),null,16),u(Y),e("main",null,[e("section",null,[e("div",ae,[e("div",se,[e("h2",te,[e("strong",oe,i(o.value),1),a[1]||(a[1]=x(" 專輯搜尋結果 "))]),u(d,{class:"btn-more-content mb-4 mb-sm-0",to:{name:"search",query:{q:b(r).query.q}}},{default:k(()=>[x(" 回到 "+i(o.value)+" 搜尋頁 ",1),a[2]||(a[2]=e("i",{class:"bi bi-arrow-left-circle"},null,-1))]),_:1},8,["to"])]),e("div",le,[(m(!0),p($,null,j(g.value.albums.data,s=>(m(),p("div",{class:"col d-flex justify-content-center",key:s.id},[e("div",ne,[e("img",{src:s.images[1].url,class:"card-img-top",alt:s.name},null,8,re),u(d,{class:"card-body stretched-link",to:{name:"album",params:{albumId:s.id}}},{default:k(()=>[e("h3",ce,i(s.name),1),e("h4",ue,i(s.artist.name),1),e("p",ie,[e("small",null,"發行日: "+i(b(E)(s.release_date)),1)])]),_:2},1032,["to"])])]))),128))]),g.value.albums.data.length!==0?(m(),D(b(X),{key:0,"page-count":R.value,"page-range":3,"margin-pages":2,"click-handler":A,"prev-text":de,"next-text":me,"container-class":"pagination",class:"py-lg-8 py-6 overflow-x-auto",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=s=>c.value=s)},null,8,["page-count","modelValue"])):M("",!0)])])]),u(Z)])}}};export{_e as default};
